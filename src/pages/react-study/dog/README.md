# 闭包缺陷

## 产生原因
hooks 的闭包陷阱是指 useEffect 等 hook 中用到了某个 state，但是没有把它加到 deps 数组里，导致 state 变了，但是执行的函数依然引用着之前的 state。

## 解决方式

它的解决方式就是正确设置 deps 数组，把用到的 state 放到 deps 数组里，这样每次 state 变了就能执行最新的函数，引用新的 state。同时要清理上次的定时器、事件监听器等。

但是这种解决闭包陷阱的方式用在定时器上不是很合适。

## 通过deps引来的问题

为什么呢？

因为现在每次 count 变了就会重置定时器，那之前的计时就重新计算，这样就会导致计时不准。

所以，这种把依赖的 state 添加到 deps 里的方式是能解决闭包陷阱，但是定时器不能这样做。

那还有什么方式能解决闭包陷阱呢？

## useRef解决闭包缺陷

useRef。

闭包陷阱产生的原因就是 useEffect 的函数里引用了某个 state，形成了闭包，那不直接引用不就行了？

useRef 是在 memorizedState 链表中放一个对象，current 保存某个值。



## 总结

解决 hooks 的闭包陷阱有两种方式：

设置依赖的 state 到 deps 数组中并添加清理函数
不直接引用 state，把 state 放到 useRef 创建的 ref 对象中再引用
处理定时器的时候，为保证计时的准确，最好使用 useRef 的方式，其余情况两种都可以。
